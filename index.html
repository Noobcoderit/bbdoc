<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B'baria Dr.</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Noto Sans Bengali',Arial,sans-serif;margin:0;padding:0;background:#f2f2f2;color:#222;transition:background .3s,color .3s}
body.dark-mode{background:#121212;color:#ddd}
h2{text-align:center;margin:0;padding:8px 0;position:sticky;top:0;background:#f2f2f2;z-index:10;font-size:16px}
body.dark-mode h2{background:#121212}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:5px;margin-bottom:5px;padding:3px;position:sticky;top:32px;background:#f2f2f2;z-index:10}
body.dark-mode .controls{background:#121212}

/* ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶¨‡¶æ‡¶ü‡¶®/‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶è‡¶ü‡¶æ ‡¶Æ‡¶æ‡¶ù‡¶æ‡¶∞‡¶ø ‡¶∏‡¶æ‡¶á‡¶ú) */
input,select,button{padding:5px 8px;font-size:12px;border-radius:5px;border:1px solid #ccc;transition:background .3s,color .3s,border .3s, transform .2s, box-shadow .2s}
body.dark-mode input,body.dark-mode select{background:#1e1e1e;color:#ddd;border:1px solid #555}
button{cursor:pointer;border:none}

/* ‡¶π‡ßã‡¶≠‡¶æ‡¶∞/‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶Ü‡¶õ‡ßá) */
button:hover:not(#submitBtn):not(.close-btn) { 
    transform: scale(1.05); 
    box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
}
input:focus, select:focus {
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); 
    border-color: #007bff;
    outline: none;
}
body.dark-mode input:focus, body.dark-mode select:focus {
    box-shadow: 0 0 5px rgba(77, 171, 245, 0.7);
    border-color: #4dabf5;
}

/* ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ */
#refreshBtn{background:#0077cc;color:#fff}
#todayDoctorBtn{background:#ff6600;color:white;font-weight:bold}
#weeklyFilter{background:#4CAF50;color:white;font-weight:bold;border:none}
#darkModeBtn{background:#555;color:#fff}
#addDoctorBtn{background:#28a745;color:#fff}

#todayDoctorBtn.active-filter-btn{box-shadow:0 2px 5px rgba(255,102,0,.5);transform:scale(1.02);border:1px solid #ff6600}

#doctorContainer{max-width:600px;margin:0 auto;padding:10px;height:calc(100vh - 150px);overflow-y:auto}

.card{padding:10px;margin:8px 0;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);opacity:0;transform:translateY(10px);background:#fff;transition:transform .2s,opacity .5s}
body.dark-mode .card{background:#1e1e1e;color:#ddd}
.card.show{opacity:1;transform:translateY(0)}
.doctor-name{font-size:18px;font-weight:bold;color:#0077cc;margin-bottom:8px;text-align:center;padding-bottom:3px;border-bottom:1px solid #f0f0f0}
body.dark-mode .doctor-name{color:#4dabf5;border-bottom:1px solid #282828}
.label{font-weight:bold;font-size:12px}
.card p{margin:2px 0;font-size:12px;}
.share-btn{display:block;width:100%;margin-top:6px;padding:6px;border-radius:5px;color:white;background:#17a2b8;text-align:center; transition: transform .2s}
.share-btn:hover { transform: scale(1.01); } 

#backToTop{position:fixed;bottom:50px;right:15px;padding:8px 12px;background:#0077cc;color:white;border:none;border-radius:50%;font-size:16px;cursor:pointer;display:none}

footer{text-align:center;font-size:7px;padding:0;margin:0;color:#555;background:#f2f2f2;position:sticky;bottom:0}
body.dark-mode footer{background:#121212;color:#aaa}

/* Loader and Doctor Count styles */
.main-loader-container{display:flex;flex-direction:column;align-items:center;justify-content:center;height:120px;color:#0077cc;animation:fadeIn .5s}
body.dark-mode .main-loader-container{color:#4dabf5}
.main-spinner{width:30px;height:30px;border-radius:50%;border:3px solid #f3f3f3;border-top:3px solid #0077cc;border-bottom:3px solid #0077cc;animation:spin 1s linear infinite;margin-bottom:5px}
body.dark-mode .main-spinner{border-top:3px solid #4dabf5;border-bottom:3px solid #4dabf5}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
@keyframes fadeIn{0%{opacity:0;transform:translateY(5px)}100%{opacity:1;transform:translateY(0)}}
#doctorCount{text-align:center;margin:1px 0 3px 0;font-weight:bold;font-size:11px}

/* --- ‡¶Ü‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü UI ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø) --- */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg, rgba(0,0,0,0.5), rgba(0,0,0,0.7));justify-content:center;align-items:center;z-index:1000;opacity:0;transition:opacity .4s, backdrop-filter .4s; backdrop-filter: blur(0px);}
.modal.show{display:flex;opacity:1;backdrop-filter: blur(5px);}

.modal .box{
    background:#fff;
    padding:30px;
    border-radius:15px;
    width:350px;
    max-width:90%;
    text-align:center;
    position:relative;
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
    transform: translateY(-20px);
    transition: transform .4s ease-out;
}
.modal.show .box{
    transform: translateY(0);
}
body.dark-mode .modal .box{background:#282828;color:#ddd; box-shadow:0 10px 30px rgba(0,0,0,0.7);}

.box h3{margin-bottom:20px;font-size:22px;color:#007bff;}
body.dark-mode .box h3{color:#4dabf5;}

/* Input field styles with focus effect */
.input-group { 
    margin: 20px 0; 
    position: relative;
    border-bottom: 2px solid #ccc;
    transition: border-bottom .3s;
}
.input-group:focus-within {
    border-bottom: 2px solid #007bff;
}
body.dark-mode .input-group { border-bottom: 2px solid #444; }
body.dark-mode .input-group:focus-within { border-bottom: 2px solid #4dabf5; }

.box input {
    width: 100%;
    padding: 8px 0;
    font-size: 14px;
    border: none;
    background: transparent;
    outline: none;
    color: #222;
    padding-bottom: 5px;
}
body.dark-mode .box input { color: #ddd; }


/* Submit Button Style (Modal) */
#submitBtn {
    width: 100%;
    padding: 10px;
    background: linear-gradient(45deg, #007bff, #00c6ff);
    color: white;
    font-size: 14px;
    font-weight: bold;
    border-radius: 8px;
    margin-top: 15px;
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
    transition: background .3s, transform .2s, box-shadow .3s;
}
#submitBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0, 123, 255, 0.6);
}

/* Close Button Style (Modal) */
.close-btn {
    width: 100%;
    padding: 10px;
    background: #dc3545; /* Red */
    color: white;
    font-size: 14px;
    font-weight: bold;
    border-radius: 8px;
    margin-top: 10px;
    transition: background .3s, transform .2s;
}
.close-btn:hover { 
    background: #c82333; 
    transform: translateY(-1px);
}

#msg{margin-top:10px;font-size:12px;min-height:15px;font-weight:bold;}

/* --- ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®: ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá --- */
@media (max-width: 600px) {
    .controls input:not(#searchInput), .controls select, .controls button {
        padding: 4px 6px; /* <-- ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        font-size: 11px;  /* <-- ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        width: calc(33.33% - 4px); 
    }
    .controls button:hover:not(#submitBtn):not(.close-btn) { 
        transform: scale(1.02); 
    }
    #searchInput {
        padding: 5px 8px; /* <-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶á‡¶®‡¶™‡ßÅ‡¶ü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        font-size: 12px; /* <-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶á‡¶®‡¶™‡ßÅ‡¶ü‡ßá‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡¶æ‡ßú‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
        margin-bottom: 3px;
    }
    #refreshBtn, #todayDoctorBtn, #weeklyFilter {
        width: calc(33.33% - 4px); 
    }
    .modal .box { padding: 20px; }
    .box h3 { font-size: 20px; }
}
</style>
</head>
<body>

<h2>‡¶¨‡ßç‡¶∞‡¶æ‡¶π‡ßç‡¶Æ‡¶£‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡¶æ ‡¶°‡¶ï‡ßç‡¶ü‡¶∞</h2>

<div class="controls">
    <input type="text" id="searchInput" placeholder="Search Name / Degree / Hospital">
    <select id="hospitalFilter"><option value="">‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤</option></select>
    <select id="treatmentFilter"><option value="">‡¶ü‡ßç‡¶∞‡¶ø‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</option></select> 
    <button id="refreshBtn">‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∏ Dr. ‚ôªÔ∏è</button>
    <button id="todayDoctorBtn">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ Dr. üë®‚Äç‚öïÔ∏è</button>
    
    <select id="weeklyFilter">
        <option value="">‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï Dr. üóìÔ∏è</option>
    </select>
    
    <button id="darkModeBtn">‡¶°‡¶æ‡¶∞‡ßç‡¶ï ‡¶Æ‡ßÅ‡¶° üåô</button>
    <button id="addDoctorBtn">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° Dr.‚ûï</button>
</div>
<p id="doctorCount"></p>

<div id="doctorContainer"></div>

<button id="backToTop" onclick="document.getElementById('doctorContainer').scrollTo({top:0, behavior:'smooth'})">‚Üë</button>

<footer>made by SJ Shakil<br>version 1.0</footer>

<div id="doctorModal" class="modal">
    <div class="box">
        <h3>Submit Doctor Information</h3>
        
        <div class="input-group">
            <input id="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" type="text">
        </div>
        <div class="input-group">
            <input id="doctor" placeholder="‡¶°‡¶ï‡ßç‡¶ü‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" type="text">
        </div>
        <div class="input-group">
            <input list="hospitalList" id="hospital" placeholder="‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" type="text">
            <datalist id="hospitalList"></datalist>
        </div>

        <button id="submitBtn">Submit</button>
        <p id="msg"></p>
        <button onclick="closeModal()" class="close-btn">‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‚ùå</button>
    </div>
</div>

<script>
const jsonUrl = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhR-Gul2odeHWlrhW_BwVV4jZeTDnM-FHOggdWfZV0KGDtqMcoIuW5tb1k9sf8FOAYoubSpNj7q0MzxDaeXjoWmZIYb0wL-w4TfFdKwp46lcKPhJO3GG1DZOteXuYXTBRtaXxu4FSYMg2RMO2zBMoXkQwt1p5XvKxVsdu4pLJ8ptBkI49pPVZl1Y5_PNSdqdbcxg3VvtoFv8MWAXRVXFJ2aY_8SrUt2Umd3v-7HA5kQBBF_ah3mAeO5cBTpogiNUDXqxu1Yz-LcV63xPORcmvULDxTDcw&lib=MDAqIAKv-Cob-tYNDcyKsIZGvrR6Rl4Ky";
let allDoctors = [];
let isTodayFilterActive = false; 

const dayNamesBangla = ["‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞", "‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞", "‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞", "‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞", "‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞"];
const dayNamesEnglish = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; 
    }
}
function getRandomColor(isDark){
    const h=Math.floor(Math.random()*360);
    return isDark ? `hsl(${h}, 30%, 20%)` : `hsl(${h}, 80%, 95%)`;
}
function generateMainLoader(statusText="‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."){
    return `<div class="main-loader-container"><div class="main-spinner"></div><p>${statusText}</p></div>`;
}

function loadDoctors(){ 
    const container = document.getElementById("doctorContainer");
    container.innerHTML = generateMainLoader("‚åõ‚åõ ‡¶¨‡ßç‡¶∞‡¶æ‡¶π‡ßç‡¶Æ‡¶£‡¶¨‡¶æ‡ßú‡¶ø‡ßü‡¶æ ‡¶°‡¶ï‡ßç‡¶ü‡¶∞ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‚åõ‚åõ"); 
    document.getElementById("doctorCount").textContent = `üïîüïî‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® üïîüïî...`;

    fetch(jsonUrl)
    .then(res=>res.json())
    .then(data=>{
        allDoctors = data; 
        shuffleArray(allDoctors); 
        populateFilters();
        renderDoctors();
    }).catch(err=>{
        container.innerHTML=generateMainLoader("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§!! ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø üò¢‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®!‚ôªÔ∏è!<br>‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® üåê"); 
        document.getElementById("doctorCount").textContent = `‡¶Æ‡ßã‡¶ü ‡ß¶ ‡¶ú‡¶® ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞`;
    });
}

function populateFilters(){
    const hospitals = [...new Set(allDoctors.map(d=>d.hospitalname))];
    const treatments = [...new Set(allDoctors.flatMap(d => d.treatment ? d.treatment.split(/[,;]/).map(t => t.trim()) : []).filter(t => t))].sort();

    const hospitalFilter = document.getElementById("hospitalFilter");
    hospitalFilter.innerHTML='<option value="">Hospital</option>';
    hospitals.forEach(h=>{hospitalFilter.innerHTML+=`<option value="${h}">${h}</option>`;});
    hospitalFilter.addEventListener("change", renderDoctors);

    const treatmentFilter = document.getElementById("treatmentFilter");
    treatmentFilter.innerHTML='<option value="">Treatment</option>';
    treatments.forEach(t=>{treatmentFilter.innerHTML+=`<option value="${t}">${t}</option>`;});
    treatmentFilter.addEventListener("change", renderDoctors); 

    const hospitalList = document.getElementById("hospitalList");
    hospitalList.innerHTML = "";
    hospitals.forEach(h=>{hospitalList.innerHTML+=`<option value="${h}">`;});

    const weeklyFilter = document.getElementById("weeklyFilter");
    weeklyFilter.innerHTML = '<option value="">‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï Dr. üóìÔ∏è</option>';
    dayNamesBangla.forEach((dayName)=>{weeklyFilter.innerHTML+=`<option value="${dayName}">${dayName}</option>`;});
    weeklyFilter.addEventListener("change", renderDoctors);
}

function isAvailableOnDay(timeString, selectedDayBangla) {
    if (!timeString || !selectedDayBangla) return true;
    const timeLower = timeString.toLowerCase();
    const selectedDayLower = selectedDayBangla.toLowerCase();
    if (timeLower.includes('‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®') || timeLower.includes('daily')) return true;
    if (timeLower.includes(selectedDayLower)) return true;
    const selectedDayIndex = dayNamesBangla.indexOf(selectedDayBangla);
    if (selectedDayIndex !== -1 && timeLower.includes(dayNamesEnglish[selectedDayIndex])) return true;
    return false;
}

function isAvailableToday(timeString) {
    if (!timeString) return false;
    const todayIndex = new Date().getDay(); 
    return isAvailableOnDay(timeString, dayNamesBangla[todayIndex]);
}

function renderDoctors(){
    const container = document.getElementById("doctorContainer");
    container.innerHTML="";
    const searchText = document.getElementById("searchInput").value.toLowerCase();
    const filterHospital = document.getElementById("hospitalFilter").value;
    const filterTreatment = document.getElementById("treatmentFilter").value; 
    const filterDay = document.getElementById("weeklyFilter").value; 

    const filteredDoctors = allDoctors.filter(d=>{
        const searchMatch = (d.doctorname.toLowerCase().includes(searchText) || d.education.toLowerCase().includes(searchText) || d.hospitalname.toLowerCase().includes(searchText) || (d.treatment && d.treatment.toLowerCase().includes(searchText))); 
        const hospitalMatch = (!filterHospital || d.hospitalname===filterHospital);
        const treatmentMatch = (!filterTreatment || (d.treatment && d.treatment.toLowerCase().includes(filterTreatment.toLowerCase())));

        const dayMatch = (!filterDay) ? true : isAvailableOnDay(d.time, filterDay);
        
        if(filterDay) isTodayFilterActive = false;
        const todayMatch = (isTodayFilterActive && !filterDay) ? isAvailableToday(d.time) : true;
        
        return searchMatch && hospitalMatch && treatmentMatch && todayMatch && dayMatch; 
    });

    // Update count & button status
    document.getElementById("doctorCount").textContent = `‡¶Æ‡ßã‡¶ü ${filteredDoctors.length} ‡¶ú‡¶® ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ${isTodayFilterActive ? "(‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)" : filterDay ? `(${filterDay} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)` : ""}`;
    const todayBtn = document.getElementById("todayDoctorBtn");
    todayBtn.classList.toggle('active-filter-btn', isTodayFilterActive && !filterDay);
    todayBtn.textContent = isTodayFilterActive ? `‡¶∏‡¶ï‡¶≤ Dr. ‚ùå` : `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ Dr. üë®‚Äç‚öïÔ∏è`;
    todayBtn.style.backgroundColor = isTodayFilterActive ? '#cc5200' : '#ff6600';


    if(filteredDoctors.length===0){
        let msg = "‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶ï‡ßç‡¶ü‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø üò¢‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶® ‚ôªÔ∏è!!";
        if (isTodayFilterActive) msg = `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®‡ßá ‡¶°‡¶ï‡ßç‡¶ü‡¶∞ ‡¶®‡ßá‡¶á‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶ï‡¶≤ Dr. ‚ùå ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§`;
        container.innerHTML=generateMainLoader(msg);
        return;
    }

    const isDarkMode = document.body.classList.contains('dark-mode');
    filteredDoctors.forEach(d=>{
        const card = document.createElement("div");
        card.className="card show"; 
        card.style.backgroundColor = getRandomColor(isDarkMode);

        card.innerHTML=`
            <div class="doctor-name">${d.doctorname}</div>
            <p><span class="label">Degree:</span> ${d.education || 'N/A'}</p>
            <p><span class="label">Hospital:</span> ${d.hospitalname || 'N/A'}</p>
            <p><span class="label">Location:</span> ${d.hosplace || 'N/A'}</p>
            <p><span class="label">Specialist:</span> ${d.treatment || 'N/A'}</p>
            <p><span class="label">Time:</span> ${d.time || 'N/A'}</p>
            <p><span class="label">Mobile:</span> ${d.mobile || 'N/A'}</p>
            <button class="share-btn" onclick="shareDoctor('${d.doctorname}','${d.hospitalname}','${d.mobile}')">‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® üì§</button>
        `;
        container.appendChild(card);
    });
}

function shareDoctor(name,hospital,phone){
    const text = `‡¶°‡¶ï‡ßç‡¶ü‡¶∞: ${name}\n‡¶π‡¶∏‡¶™‡¶ø‡¶ü‡¶æ‡¶≤: ${hospital}\n‡¶´‡ßã‡¶®: ${phone}`;
    if(navigator.share){ navigator.share({title:"Doctor Info", text}); }
    else{ prompt("Copy this info:", text); }
}

document.getElementById("searchInput").addEventListener("input", renderDoctors);
document.getElementById("refreshBtn").addEventListener("click", loadDoctors); 
document.getElementById("todayDoctorBtn").addEventListener("click", () => {
    isTodayFilterActive = !isTodayFilterActive; 
    document.getElementById("weeklyFilter").value = ""; 
    renderDoctors(); 
});

document.getElementById("darkModeBtn").addEventListener("click", ()=>{
    document.body.classList.toggle("dark-mode");
    document.querySelectorAll('.card').forEach(card => {
        card.style.backgroundColor = getRandomColor(document.body.classList.contains('dark-mode'));
    });
});
loadDoctors();

document.getElementById("doctorContainer").addEventListener("scroll",()=>{
    const btn=document.getElementById("backToTop");
    btn.style.display=document.getElementById("doctorContainer").scrollTop>300?"block":"none";
});

// Modal Form Logic
const modal = document.getElementById("doctorModal");
document.getElementById("addDoctorBtn").addEventListener("click", ()=>{ modal.classList.add("show"); });
function closeModal(){ 
    modal.classList.remove("show"); 
    // Reset form after closing
    document.getElementById("name").value=""; 
    document.getElementById("doctor").value=""; 
    document.getElementById("hospital").value="";
    document.getElementById("msg").innerText = "";
    document.getElementById("submitBtn").textContent = 'Submit';
}

const submitBtn = document.getElementById("submitBtn");
const msg = document.getElementById("msg");

submitBtn.addEventListener("click", (e)=>{
    e.preventDefault(); 
    const name = document.getElementById("name").value.trim();
    const doctor = document.getElementById("doctor").value.trim();
    const hospital = document.getElementById("hospital").value.trim();
    
    if(!name || !doctor || !hospital){
        msg.innerText="‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§ ‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá!"; msg.style.color="red"; setTimeout(()=>{ msg.innerText=""; },3000); return;
    }

    submitBtn.textContent = 'Submitting...‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá'; 
    
    fetch("https://script.google.com/macros/s/AKfycbxpZRGPgFZlGgHhRAC3Mg0uhRxS2iFhZF4QVFP4A36CHPktsTWv-y8XKkrRP9pcRwla/exec",{
        method:"POST", body: JSON.stringify({name, doctor, hospital})
    })
    .then(res=>res.text())
    .then(()=>{
        submitBtn.textContent = 'Submit';
        msg.innerText="‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶ü§ùSubmitted Successfully ‚úÖ"; msg.style.color="green";
        
        setTimeout(() => { closeModal(); loadDoctors(); }, 4000); 
    })
    .catch(()=>{
        submitBtn.textContent = 'Submit';
        msg.innerText="Error submitting! Try again."; msg.style.color="red";
        setTimeout(()=>{ msg.innerText=""; },3000);
    });
});
</script>
</body>
</html>